<!doctype html>
<html lang="en">
	<head>
		<title>CSnap! 11.0.0 - Django Integration Example</title>
		<link rel="icon" href="/applications/{{ application.id }}/snap/src/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="/applications/{{ application.id }}/style.css" />

		<!-- Configure CSnap with Django paths -->
		<script type="text/javascript">
			let config = {
				modules: [],
				// IMPORTANT: Set asset_path to your Django application's base path
				asset_path: "/applications/{{ application.id }}/",
				urls: {
					demos_url: "demo.xml",
					goals_url: "goals.xml",
				},
				// Optional: Load a specific project
				{% if project_id %}
				project: {{ project_id }},
				{% endif %}
			};
		</script>

		<link rel="manifest" href="/applications/{{ application.id }}/snap/manifest.json" />
		<link rel="apple-touch-icon" href="/applications/{{ application.id }}/snap/img/snap-icon-152.png" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="white" />

		<!-- Load CSnap core libraries -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/exporters/STLExporter.js"></script>

		<!-- Load Snap base scripts -->
		<script src="/applications/{{ application.id }}/snap/src/morphic.js?version=2025-03-20"></script>
		<script src="/applications/{{ application.id }}/csnap/morphic.js"></script>

		<script src="/applications/{{ application.id }}/snap/src/symbols.js?version=2024-11-24"></script>
		<script src="/applications/{{ application.id }}/snap/src/widgets.js?version=2025-03-17"></script>

		<script src="/applications/{{ application.id }}/snap/src/blocks.js?version=2025-08-23"></script>
		<script src="/applications/{{ application.id }}/csnap/blocks.js"></script>

		<script src="/applications/{{ application.id }}/snap/src/threads.js?version=2025-08-18"></script>
		<script src="/applications/{{ application.id }}/csnap/threads.js"></script>

		<script src="/applications/{{ application.id }}/snap/src/objects.js?version=2025-08-18"></script>
		<script src="/applications/{{ application.id }}/csnap/objects.js"></script>

		<script src="/applications/{{ application.id }}/snap/src/scenes.js?version=2024-05-28"></script>

		<script src="/applications/{{ application.id }}/snap/src/gui.js?version=2025-08-23"></script>
		<script src="/applications/{{ application.id }}/csnap/gui.js"></script>

		<script src="/applications/{{ application.id }}/snap/src/paint.js?version=2023-05-24"></script>
		<script src="/applications/{{ application.id }}/snap/src/lists.js?version=2025-06-12"></script>

		<script src="/applications/{{ application.id }}/snap/src/byob.js?version=2025-05-13"></script>
		<script src="/applications/{{ application.id }}/csnap/byob.js"></script>

		<script src="/applications/{{ application.id }}/snap/src/tables.js?version=2025-04-03"></script>
		<script src="/applications/{{ application.id }}/snap/src/sketch.js?version=2023-05-24"></script>
		<script src="/applications/{{ application.id }}/snap/src/video.js?version=2019-06-27"></script>
		<script src="/applications/{{ application.id }}/snap/src/maps.js?version=2021-06-15"></script>

		<script src="/applications/{{ application.id }}/snap/src/extensions.js?version=2025-06-03"></script>
		<script src="/applications/{{ application.id }}/csnap/extensions.js"></script>

		<script src="/applications/{{ application.id }}/snap/src/xml.js?version=2021-07-05"></script>

		<script src="/applications/{{ application.id }}/snap/src/store.js?version=2025-04-01"></script>
		<script src="/applications/{{ application.id }}/csnap/store.js"></script>

		<script src="/applications/{{ application.id }}/snap/src/locale.js?version=2025-08-19"></script>

		<script src="/applications/{{ application.id }}/snap/src/cloud.js?version=2023-04-12"></script>
		<script src="/applications/{{ application.id }}/csnap/cloud.js"></script>

		<script src="/applications/{{ application.id }}/snap/src/api.js?version=2024-02-22"></script>
		<script src="/applications/{{ application.id }}/snap/src/embroider.js?version=2024-05-09"></script>
		<script src="/applications/{{ application.id }}/snap/src/sha512.js?version=2019-06-27"></script>
		<script src="/applications/{{ application.id }}/snap/src/FileSaver.min.js?version=2019-06-27"></script>

		<script src="/applications/{{ application.id }}/csnap/tutorials.js"></script>

		<!-- Initialize CSnap -->
		<script>
			var world;
			window.onload = function () {
				var FPS = 60,
					lastTime = 0,
					loop = (timestamp) => {
						requestAnimationFrame(loop);
						if (timestamp - lastTime < 1000 / FPS) {
							return;
						}
						world.doOneCycle();
						lastTime = Math.max(lastTime + 1000 / FPS, timestamp - 1000 / FPS);
					};

				// Note: Service worker registration may need adjustment for Django paths
				// if ("serviceWorker" in navigator) {
				//     navigator.serviceWorker.register("/applications/{{ application.id }}/sw.js");
				// }

				world = new WorldMorph(document.getElementById("world"));
				new IDE_Morph({
					// CRITICAL: This assetPath must match the config.asset_path above
					assetPath: "/applications/{{ application.id }}/",
					// Optional configurations
					hideCamera: {{ hide_camera|default:"false"|lower }},
					presentation: {{ presentation_mode|default:"false"|lower }},
				}).openIn(world);
				requestAnimationFrame(loop);
			};
		</script>
	</head>
	<body style="margin: 0">
		<canvas id="world" tabindex="1" style="position: absolute"></canvas>
	</body>
</html>

